/* global pm, wpcom_reblog */

var jetpackLikesWidgetQueue = [];
var jetpackLikesWidgetBatch = [];
var jetpackLikesMasterReady = false;

function JetpackLikespostMessage( message, target ) {
	if ( 'string' === typeof message ){
		try {
			message = JSON.parse( message );
		} catch(e) {
			return;
		}
	}

	pm( {
		target: target,
		type: 'likesMessage',
		data: message,
		origin: '*'
	} );
}

function JetpackLikesBatchHandler() {
	var requests = [];
	jQuery( 'div.jetpack-likes-widget-unloaded' ).each( function() {
		if ( jetpackLikesWidgetBatch.indexOf( this.id ) > -1 ) {
			return;
		}
		jetpackLikesWidgetBatch.push( this.id );
		var regex = /like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/,
			match = regex.exec( this.id ),
			info;

		if ( ! match || match.length !== 5 ) {
			return;
		}

		info = {
			blog_id: match[2],
			width:   this.width
		};

		if ( 'post' === match[1] ) {
			info.post_id = match[3];
		} else if ( 'comment' === match[1] ) {
			info.comment_id = match[3];
		}

		info.obj_id = match[4];

		requests.push( info );
	});

	if ( requests.length > 0 ) {
		JetpackLikespostMessage( { event: 'initialBatch', requests: requests }, window.frames['likes-master'] );
	}
}

function JetpackLikesMessageListener( event, message ) {
	var allowedOrigin, $container, $list, offset, rowLength, height, scrollbarWidth;

	if ( 'undefined' === typeof event.event ) {
		return;
	}

	// We only allow messages from one origin
	allowedOrigin = window.location.protocol + '//widgets.wp.com';
	if ( allowedOrigin !== message.origin ) {
		return;
	}

	if ( 'masterReady' === event.event ) {
		jQuery( document ).ready( function() {
			jetpackLikesMasterReady = true;

			var stylesData = {
					event: 'injectStyles'
				},
				$sdTextColor = jQuery( '.sd-text-color' ),
				$sdLinkColor = jQuery( '.sd-link-color' );

			if ( jQuery( 'iframe.admin-bar-likes-widget' ).length > 0 ) {
				JetpackLikespostMessage( { event: 'adminBarEnabled' }, window.frames[ 'likes-master' ] );

				stylesData.adminBarStyles = {
					background: jQuery( '#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a' ).css( 'background' ),
					isRtl: ( 'rtl' === jQuery( '#wpadminbar' ).css( 'direction' ) )
				};
			}

			if ( ! window.addEventListener ) {
				jQuery( '#wp-admin-bar-admin-bar-likes-widget' ).hide();
			}

			stylesData.textStyles = {
				color:          $sdTextColor.css( 'color' ),
				fontFamily:     $sdTextColor.css( 'font-family' ),
				fontSize:       $sdTextColor.css( 'font-size' ),
				direction:      $sdTextColor.css( 'direction' ),
				fontWeight:     $sdTextColor.css( 'font-weight' ),
				fontStyle:      $sdTextColor.css( 'font-style' ),
				textDecoration: $sdTextColor.css('text-decoration')
			};

			stylesData.linkStyles = {
				color:          $sdLinkColor.css('color'),
				fontFamily:     $sdLinkColor.css('font-family'),
				fontSize:       $sdLinkColor.css('font-size'),
				textDecoration: $sdLinkColor.css('text-decoration'),
				fontWeight:     $sdLinkColor.css( 'font-weight' ),
				fontStyle:      $sdLinkColor.css( 'font-style' )
			};

			JetpackLikespostMessage( stylesData, window.frames[ 'likes-master' ] );

			JetpackLikesBatchHandler();

			jQuery( document ).on( 'inview', 'div.jetpack-likes-widget-unloaded', function() {
				jetpackLikesWidgetQueue.push( this.id );
			});
		});
	}

	if ( 'showLikeWidget' === event.event ) {
		jQuery( '#' + event.id + ' .post-likes-widget-placeholder'  ).fadeOut( 'fast', function() {
			jQuery( '#' + event.id + ' .post-likes-widget' ).fadeIn( 'fast', function() {
				JetpackLikespostMessage( { event: 'likeWidgetDisplayed', blog_id: event.blog_id, post_id: event.post_id, obj_id: event.obj_id }, window.frames['likes-master'] );
			});
		});
	}

	if ( 'clickReblogFlair' === event.event ) {
		wpcom_reblog.toggle_reblog_box_flair( event.obj_id );
	}

	if ( 'showOtherGravatars' === event.event ) {
		$container = jQuery( '#likes-other-gravatars' );
		$list = $container.find( 'ul' );

		$container.hide();
		$list.html( '' );

		$container.find( '.likes-text span' ).text( event.total );

		jQuery.each( event.likers, function( i, liker ) {
			var element = jQuery( '<li><a><img /></a></li>' );
			element.addClass( liker.css_class );

			element.find( 'a' ).
				attr({
					href: liker.profile_URL,
					rel: 'nofollow',
					target: '_parent'
				}).
				addClass( 'wpl-liker' );

			element.find( 'img' ).
				attr({
					src: liker.avatar_URL,
					alt: liker.name
				}).
				css({
					width: '30px',
					height: '30px',
					paddingRight: '3px'
				});

			$list.append( element );
		} );

		offset = jQuery( '[name=\'' + event.parent + '\']' ).offset();

		$container.css( 'left', offset.left + event.position.left - 10 + 'px' );
		$container.css( 'top', offset.top + event.position.top - 33 + 'px' );

		rowLength = Math.floor( event.width / 37 );
		height = ( Math.ceil( event.likers.length / rowLength ) * 37 ) + 13;
		if ( height > 204 ) {
			height = 204;
		}

		$container.css( 'height', height + 'px' );
		$container.css( 'width', rowLength * 37 - 7 + 'px' );

		$list.css( 'width', rowLength * 37 + 'px' );

		$container.fadeIn( 'slow' );

		scrollbarWidth = $list[0].offsetWidth - $list[0].clientWidth;
		if ( scrollbarWidth > 0 ) {
			$container.width( $container.width() + scrollbarWidth );
			$list.width( $list.width() + scrollbarWidth );
		}
	}
}

pm.bind( 'likesMessage', JetpackLikesMessageListener );

jQuery( document ).click( function( e ) {
	var $container = jQuery( '#likes-other-gravatars' );

	if ( $container.has( e.target ).length === 0 ) {
		$container.fadeOut( 'slow' );
	}
});

function JetpackLikesWidgetQueueHandler() {
	var $wrapper, wrapperID, found;
	if ( ! jetpackLikesMasterReady ) {
		setTimeout( JetpackLikesWidgetQueueHandler, 500 );
		return;
	}

	if ( jetpackLikesWidgetQueue.length > 0 ) {
		// We may have a widget that needs creating now
		found = false;
		while( jetpackLikesWidgetQueue.length > 0 ) {
			// Grab the first member of the queue that isn't already loading.
			wrapperID = jetpackLikesWidgetQueue.splice( 0, 1 )[0];
			if ( jQuery( '#' + wrapperID ).hasClass( 'jetpack-likes-widget-unloaded' ) ) {
				found = true;
				break;
			}
		}
		if ( ! found ) {
			setTimeout( JetpackLikesWidgetQueueHandler, 500 );
			return;
		}
	} else if ( jQuery( 'div.jetpack-likes-widget-unloaded' ).length > 0 ) {
		// Grab any unloaded widgets for a batch request
		JetpackLikesBatchHandler();

		// Get the next unloaded widget
		wrapperID = jQuery( 'div.jetpack-likes-widget-unloaded' ).first()[0].id;
		if ( ! wrapperID ) {
			// Everything is currently loaded
			setTimeout( JetpackLikesWidgetQueueHandler, 500 );
			return;
		}
	}

	if ( 'undefined' === typeof wrapperID ) {
		setTimeout( JetpackLikesWidgetQueueHandler, 500 );
		return;
	}

	$wrapper = jQuery( '#' + wrapperID );
	$wrapper.find( 'iframe' ).remove();

	if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
		$wrapper.find( '.post-likes-widget-placeholder' ).after( '<iframe class="post-likes-widget jetpack-likes-widget" name="' + $wrapper.data( 'name' ) + '" height="22px" width="68px" frameBorder="0" scrolling="no" src="' + $wrapper.data( 'src' ) + '"></iframe>' );
	} else {
		$wrapper.find( '.post-likes-widget-placeholder' ).after( '<iframe class="post-likes-widget jetpack-likes-widget" name="' + $wrapper.data( 'name' ) + '" height="55px" width="100%" frameBorder="0" src="' + $wrapper.data( 'src' ) + '"></iframe>' );
	}

	$wrapper.removeClass( 'jetpack-likes-widget-unloaded' ).addClass( 'jetpack-likes-widget-loading' );

	$wrapper.find( 'iframe' ).load( function( e ) {
		var $iframe = jQuery( e.target );
		$wrapper.removeClass( 'jetpack-likes-widget-loading' ).addClass( 'jetpack-likes-widget-loaded' );

		JetpackLikespostMessage( { event: 'loadLikeWidget', name: $iframe.attr( 'name' ), width: $iframe.width() }, window.frames[ 'likes-master' ] );

		if ( $wrapper.hasClass( 'slim-likes-widget' ) ) {
			$wrapper.find( 'iframe' ).Jetpack( 'resizeable' );
		}
	});
	setTimeout( JetpackLikesWidgetQueueHandler, 250 );
}
JetpackLikesWidgetQueueHandler();
;
!function(a){a.fn.onScreen=function(b){var c={container:window,direction:"vertical",toggleClass:null,doIn:null,doOut:null,tolerance:0,throttle:null,lazyAttr:null,lazyPlaceholder:"data:image/gif;base64,R0lGODlhEAAFAIAAAP///////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAAACwAAAAAEAAFAAACCIyPqcvtD00BACH5BAkJAAIALAAAAAAQAAUAgfT29Pz6/P///wAAAAIQTGCiywKPmjxUNhjtMlWrAgAh+QQJCQAFACwAAAAAEAAFAIK8urzc2tzEwsS8vrzc3tz///8AAAAAAAADFEiyUf6wCEBHvLPemIHdTzCMDegkACH5BAkJAAYALAAAAAAQAAUAgoSChLS2tIyKjLy+vIyOjMTCxP///wAAAAMUWCQ09jAaAiqQmFosdeXRUAkBCCUAIfkECQkACAAsAAAAABAABQCDvLq83N7c3Nrc9Pb0xMLE/P78vL68/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCEwkCnKGbegvQn4RjGMx8F1HxBi5Il4oEiap2DcVYlpZwQAIfkECQkACAAsAAAAABAABQCDvLq85OLkxMLE9Pb0vL685ObkxMbE/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCDwnCGHEcIMxPn4VAGMQNBx0zQEZHkiYNiap5RaBKG9EQAh+QQJCQAJACwAAAAAEAAFAIOEgoTMysyMjozs6uyUlpSMiozMzsyUkpTs7uz///8AAAAAAAAAAAAAAAAAAAAAAAAEGTBJiYgoBM09DfhAwHEeKI4dGKLTIHzCwEUAIfkECQkACAAsAAAAABAABQCDvLq85OLkxMLE9Pb0vL685ObkxMbE/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCAQSTmMEGaco8+UBSACwWBqHxKOJYd+q1iaXFoRRMbtEQAh+QQJCQAIACwAAAAAEAAFAIO8urzc3tzc2tz09vTEwsT8/vy8vrz8+vz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAEIhBJWc6wJZAtJh3gcRBAaXiIZV2kiRbgNZbA6VXiUAhGL0QAIfkECQkABgAsAAAAABAABQCChIKEtLa0jIqMvL68jI6MxMLE////AAAAAxRoumxFgoxGCbiANos145e3DJcQJAAh+QQJCQAFACwAAAAAEAAFAIK8urzc2tzEwsS8vrzc3tz///8AAAAAAAADFFi6XCQwtCmAHbPVm9kGWKcEQxkkACH5BAkJAAIALAAAAAAQAAUAgfT29Pz6/P///wAAAAIRlI8SAZsPYnuJMUCRnNksWwAAOw==",debug:!1};return"remove"!==b&&a.extend(c,b),this.each(function(){function d(){a(w).off("scroll.onScreen resize.onScreen"),a(window).off("resize.onScreen")}function e(){return z?u<q-c.tolerance&&l<u+s-c.tolerance:u<o-c.tolerance&&u>-s+c.tolerance}function f(){return z?u+(s-c.tolerance)<l||u>q-c.tolerance:u>o-c.tolerance||-s+c.tolerance>u}function g(){return z?v<r-c.tolerance&&m<v+t-c.tolerance:v<p-c.tolerance&&v>-t+c.tolerance}function h(){return z?v+(t-c.tolerance)<m||v>r-c.tolerance:v>p-c.tolerance||-t+c.tolerance>v}function i(){return!x&&("horizontal"===c.direction?g():e())}function j(){return!!x&&("horizontal"===c.direction?h():f())}function k(a,b,c){var d,e,f;return function(){e=arguments,f=!0,c=c||this,d||!function(){f?(a.apply(c,e),f=!1,d=setTimeout(arguments.callee,b)):d=null}()}}var l,m,n,o,p,q,r,s,t,u,v,w=this,x=!1,y=a(this),z=a.isWindow(c.container);if("remove"===b)return void d();var A=function(){if(z||"static"!==a(c.container).css("position")||a(c.container).css("position","relative"),n=a(c.container),o=n.height(),p=n.width(),q=n.scrollTop()+o,r=n.scrollLeft()+p,s=y.outerHeight(!0),t=y.outerWidth(!0),z){var b=y.offset();u=b.top,v=b.left}else{var d=y.position();u=d.top,v=d.left}if(l=n.scrollTop(),m=n.scrollLeft(),c.debug&&(console.log("Container: "+c.container+"\nWidth: "+o+"\nHeight: "+p+"\nBottom: "+q+"\nRight: "+r),console.log("Matched element: "+(void 0!==y.attr("class")?y.prop("tagName").toLowerCase()+"."+y.attr("class"):y.prop("tagName").toLowerCase())+"\nLeft: "+v+"\nTop: "+u+"\nWidth: "+t+"\nHeight: "+s)),i()){if(c.toggleClass&&y.addClass(c.toggleClass),a.isFunction(c.doIn)&&c.doIn.call(y[0]),c.lazyAttr&&"IMG"===y.prop("tagName")){var e=y.attr(c.lazyAttr);e!==y.prop("src")&&(y.css({background:"url("+c.lazyPlaceholder+") 50% 50% no-repeat",minHeight:"5px",minWidth:"16px"}),y.prop("src",e).load(function(){a(this).css({background:"none"})}))}x=!0}else j()&&(c.toggleClass&&y.removeClass(c.toggleClass),a.isFunction(c.doOut)&&c.doOut.call(y[0]),x=!1)};window.location.hash?k(A,50):A(),c.throttle&&(A=k(A,c.throttle)),a(c.container).on("scroll.onScreen resize.onScreen",A),z||a(window).on("resize.onScreen",A),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jQuery:"function"==typeof define&&define.amd&&define("jquery-onscreen",[],function(){return jQuery})})}}(jQuery),function(a,b){"use strict";var c=function(){b("[data-animate]").each(function(){var c=b(this);return!c.parent().hasClass("gif-player")&&void c.one("load",function(){var d,e,f,g=b(this),h=g.data("animate"),i=g.attr("src"),j=g.width(),k=g.height(),l=g.wrap('<span class="gif-player"></span>').parent(),m=b('<img class="gif-to-play">').attr("width",j).attr("height",k),n=function(a){var c,e,f=new Image;f.src=h,c=b(a).parent(),c.hasClass("gif-playing")||(e=c.append(b('<span class="gif-loading"></span>')).find(".gif-loading"),c.append(m),b(f).load(function(){e.remove(),m.attr("src",f.src)}),c.addClass("gif-playing"),d&&d.remove())};1!==c.data("autoplay")&&(d=l.append(b('<div class="play-button"></div>')).find(".play-button")),g.data("src",i),1===c.data("autoplay")&&c.onScreen({container:a,direction:"vertical",doIn:function(){n(this)},doOut:function(){},tolerance:k/2,throttle:50,toggleClass:"onScreen",lazyAttr:null,debug:!1}),l.one("mouseenter",function(a){n(b(this).find("img")),a.stopPropagation(),a.preventDefault()}),l.on("click",function(a){n(b(this).find("img")),a.stopPropagation(),a.preventDefault()}),e=1,f=a.setInterval(function(){var c=b(".onScreen");c.length>0?(n(c),a.clearInterval(f)):(e++,e>3&&a.clearInterval(f))},1e3)}).each(function(){this.complete&&b(this).load()})})};c(),a.checkGifAnimation=c}(this,jQuery);;
window.wp=window.wp||{},function(a){var b="undefined"==typeof _wpUtilSettings?{}:_wpUtilSettings;wp.template=_.memoize(function(b){var c,d={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e){return(c=c||_.template(a("#tmpl-"+b).html(),d))(e)}}),wp.ajax={settings:b.ajax||{},post:function(a,b){return wp.ajax.send({data:_.isObject(a)?a:_.extend(b||{},{action:a})})},send:function(b,c){var d,e;return _.isObject(b)?c=b:(c=c||{},c.data=_.extend(c.data||{},{action:b})),c=_.defaults(c||{},{type:"POST",url:wp.ajax.settings.url,context:this}),e=a.Deferred(function(b){c.success&&b.done(c.success),c.error&&b.fail(c.error),delete c.success,delete c.error,b.jqXHR=a.ajax(c).done(function(a){"1"!==a&&1!==a||(a={success:!0}),_.isObject(a)&&!_.isUndefined(a.success)?b[a.success?"resolveWith":"rejectWith"](this,[a.data]):b.rejectWith(this,[a])}).fail(function(){b.rejectWith(this,arguments)})}),d=e.promise(),d.abort=function(){return e.jqXHR.abort(),this},d}}}(jQuery);;
/*! FiveThirtyEight - v0.1.0
 * 
 * Licensed GPLv2+ */
"undefined"!=typeof jQuery&&!function(a){var b={xdomain:"*",ie:navigator.userAgent.toLowerCase().indexOf("msie")>-1,scrollToTop:!0},c={init:function(){return this.each(function(){var c=a(this);window.postMessage?window.addEventListener?window.addEventListener("message",function(a){d.messageHandler(c,a)},!1):window.attachEvent&&window.attachEvent("onmessage",function(a){d.messageHandler(c,a)},c):setInterval(function(){var a=window.location.hash,e=a.match(/^#h(\d+)(s?)$/);e&&(d.setHeight(c,e[1]),b.scrollToTop&&"s"===e[2]&&scroll(0,0))},150)})}},d={messageHandler:function(a,c){var e,f,g,h;if("*"!==b.xdomain){var i=new RegExp(b.xdomain+"$");if("null"==c.origin)throw new Error("messageHandler( elem, e): There is no origin.  You are viewing the page from your file system.  Please run through a web server.");if(!c.origin.match(i))throw new Error("messageHandler( elem, e): The orgin doesn't match the responsiveiframe  xdomain.");g=!0}if(("*"===b.xdomain||g)&&(h=c.data+"",f=h.match(/^(\d+)(s?)$/),f&&3===f.length)){if(e=parseInt(f[1],10),!isNaN(e))try{d.setHeight(a,e)}catch(a){}b.scrollToTop&&"s"===f[2]&&scroll(0,0)}},setHeight:function(a,b){a.css("height",b+"px")},getDocHeight:function(){var a=document;return Math.min(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}};a.fn.responsiveIframe=function(d){return c[d]?c[d].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof d&&d?void a.error("Method "+d+" does not exist on jQuery.responsiveIframe"):(a.extend(b,arguments[0]),c.init.apply(this))}}(jQuery),function(){function a(){return new d}var b,c,d=function(){b=this};d.prototype.allowResponsiveEmbedding=function(){window.addEventListener?(window.addEventListener("load",b.messageParent,!1),window.addEventListener("resize",b.messageParent,!1)):window.attachEvent&&(window.attachEvent("onload",b.messageParent),window.attachEvent("onresize",b.messageParent))},d.prototype.messageParent=function(a){var b=document.body.offsetHeight;b=a?b+"s":b,top.postMessage?top.postMessage(b,"*"):window.location.hash="h"+b},"undefined"==typeof exports?window.responsiveIframe=a:c.exports.responsiveIframe=a}(),function(a,b,c,d){var e=c("html"),f=c(a),g=c(b),h=c.fancybox=function(){h.open.apply(this,arguments)},i=navigator.userAgent.match(/msie/i),j=null,k=b.createTouch!==d,l=function(a){return a&&a.hasOwnProperty&&a instanceof c},m=function(a){return a&&"string"===c.type(a)},n=function(a){return m(a)&&0<a.indexOf("%")},o=function(a,b){var c=parseInt(a,10)||0;return b&&n(a)&&(c*=h.getViewport()[b]/100),Math.ceil(c)},p=function(a,b){return o(a,b)+"px"};c.extend(h,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!k,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(i?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:c.noop,beforeLoad:c.noop,afterLoad:c.noop,beforeShow:c.noop,afterShow:c.noop,beforeChange:c.noop,beforeClose:c.noop,afterClose:c.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(a,b){if(a&&(c.isPlainObject(b)||(b={}),!1!==h.close(!0)))return c.isArray(a)||(a=l(a)?c(a).get():[a]),c.each(a,function(e,f){var g,i,j,k,n,o={};"object"===c.type(f)&&(f.nodeType&&(f=c(f)),l(f)?(o={href:f.data("fancybox-href")||f.attr("href"),title:f.data("fancybox-title")||f.attr("title"),isDom:!0,element:f},c.metadata&&c.extend(!0,o,f.metadata())):o=f),g=b.href||o.href||(m(f)?f:null),i=b.title!==d?b.title:o.title||"",k=(j=b.content||o.content)?"html":b.type||o.type,!k&&o.isDom&&(k=f.data("fancybox-type"),k||(k=(k=f.prop("class").match(/fancybox\.(\w+)/))?k[1]:null)),m(g)&&(k||(h.isImage(g)?k="image":h.isSWF(g)?k="swf":"#"===g.charAt(0)?k="inline":m(f)&&(k="html",j=f)),"ajax"===k&&(n=g.split(/\s+/,2),g=n.shift(),n=n.shift())),j||("inline"===k?g?j=c(m(g)?g.replace(/.*(?=#[^\s]+$)/,""):g):o.isDom&&(j=f):"html"===k?j=g:!k&&!g&&o.isDom&&(k="inline",j=f)),c.extend(o,{href:g,type:k,content:j,title:i,selector:n}),a[e]=o}),h.opts=c.extend(!0,{},h.defaults,b),b.keys!==d&&(h.opts.keys=!!b.keys&&c.extend({},h.defaults.keys,b.keys)),h.group=a,h._start(h.opts.index)},cancel:function(){var a=h.coming;a&&!1!==h.trigger("onCancel")&&(h.hideLoading(),h.ajaxLoad&&h.ajaxLoad.abort(),h.ajaxLoad=null,h.imgPreload&&(h.imgPreload.onload=h.imgPreload.onerror=null),a.wrap&&a.wrap.stop(!0,!0).trigger("onReset").remove(),h.coming=null,h.current||h._afterZoomOut(a))},close:function(a){h.cancel(),!1!==h.trigger("beforeClose")&&(h.unbindEvents(),h.isActive&&(h.isOpen&&!0!==a?(h.isOpen=h.isOpened=!1,h.isClosing=!0,c(".fancybox-item, .fancybox-nav").remove(),h.wrap.stop(!0,!0).removeClass("fancybox-opened"),h.transitions[h.current.closeMethod]()):(c(".fancybox-wrap").stop(!0).trigger("onReset").remove(),h._afterZoomOut())))},play:function(a){var b=function(){clearTimeout(h.player.timer)},c=function(){b(),h.current&&h.player.isActive&&(h.player.timer=setTimeout(h.next,h.current.playSpeed))},d=function(){b(),g.unbind(".player"),h.player.isActive=!1,h.trigger("onPlayEnd")};!0===a||!h.player.isActive&&!1!==a?h.current&&(h.current.loop||h.current.index<h.group.length-1)&&(h.player.isActive=!0,g.bind({"onCancel.player beforeClose.player":d,"onUpdate.player":c,"beforeLoad.player":b}),c(),h.trigger("onPlayStart")):d()},next:function(a){var b=h.current;b&&(m(a)||(a=b.direction.next),h.jumpto(b.index+1,a,"next"))},prev:function(a){var b=h.current;b&&(m(a)||(a=b.direction.prev),h.jumpto(b.index-1,a,"prev"))},jumpto:function(a,b,c){var e=h.current;e&&(a=o(a),h.direction=b||e.direction[a>=e.index?"next":"prev"],h.router=c||"jumpto",e.loop&&(0>a&&(a=e.group.length+a%e.group.length),a%=e.group.length),e.group[a]!==d&&(h.cancel(),h._start(a)))},reposition:function(a,b){var d,e=h.current,f=e?e.wrap:null;f&&(d=h._getPosition(b),a&&"scroll"===a.type?(delete d.position,f.stop(!0,!0).animate(d,200)):(f.css(d),e.pos=c.extend({},e.dim,d)))},update:function(a){var b=a&&a.type,c=!b||"orientationchange"===b;c&&(clearTimeout(j),j=null),h.isOpen&&!j&&(j=setTimeout(function(){var d=h.current;d&&!h.isClosing&&(h.wrap.removeClass("fancybox-tmp"),(c||"load"===b||"resize"===b&&d.autoResize)&&h._setDimension(),"scroll"===b&&d.canShrink||h.reposition(a),h.trigger("onUpdate"),j=null)},c&&!k?0:300))},toggle:function(a){h.isOpen&&(h.current.fitToView="boolean"===c.type(a)?a:!h.current.fitToView,k&&(h.wrap.removeAttr("style").addClass("fancybox-tmp"),h.trigger("onUpdate")),h.update())},hideLoading:function(){g.unbind(".loading"),c("#fancybox-loading").remove()},showLoading:function(){var a,b;h.hideLoading(),a=c('<div id="fancybox-loading"><div></div></div>').click(h.cancel).appendTo("body"),g.bind("keydown.loading",function(a){27===(a.which||a.keyCode)&&(a.preventDefault(),h.cancel())}),h.defaults.fixed||(b=h.getViewport(),a.css({position:"absolute",top:.5*b.h+b.y,left:.5*b.w+b.x}))},getViewport:function(){var b=h.current&&h.current.locked||!1,c={x:f.scrollLeft(),y:f.scrollTop()};return b?(c.w=b[0].clientWidth,c.h=b[0].clientHeight):(c.w=k&&a.innerWidth?a.innerWidth:f.width(),c.h=k&&a.innerHeight?a.innerHeight:f.height()),c},unbindEvents:function(){h.wrap&&l(h.wrap)&&h.wrap.unbind(".fb"),g.unbind(".fb"),f.unbind(".fb")},bindEvents:function(){var a,b=h.current;b&&(f.bind("orientationchange.fb"+(k?"":" resize.fb")+(b.autoCenter&&!b.locked?" scroll.fb":""),h.update),(a=b.keys)&&g.bind("keydown.fb",function(e){var f=e.which||e.keyCode,g=e.target||e.srcElement;return(27!==f||!h.coming)&&void(!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(!g||!g.type&&!c(g).is("[contenteditable]"))&&c.each(a,function(a,g){return 1<b.group.length&&g[f]!==d?(h[a](g[f]),e.preventDefault(),!1):-1<c.inArray(f,g)?(h[a](),e.preventDefault(),!1):void 0}))}),c.fn.mousewheel&&b.mouseWheel&&h.wrap.bind("mousewheel.fb",function(a,d,e,f){for(var g=c(a.target||null),i=!1;g.length&&!i&&!g.is(".fancybox-skin")&&!g.is(".fancybox-wrap");)i=g[0]&&!(g[0].style.overflow&&"hidden"===g[0].style.overflow)&&(g[0].clientWidth&&g[0].scrollWidth>g[0].clientWidth||g[0].clientHeight&&g[0].scrollHeight>g[0].clientHeight),g=c(g).parent();0!==d&&!i&&1<h.group.length&&!b.canShrink&&(0<f||0<e?h.prev(0<f?"down":"left"):(0>f||0>e)&&h.next(0>f?"up":"right"),a.preventDefault())}))},trigger:function(a,b){var d,e=b||h.coming||h.current;if(e){if(c.isFunction(e[a])&&(d=e[a].apply(e,Array.prototype.slice.call(arguments,1))),!1===d)return!1;e.helpers&&c.each(e.helpers,function(b,d){d&&h.helpers[b]&&c.isFunction(h.helpers[b][a])&&h.helpers[b][a](c.extend(!0,{},h.helpers[b].defaults,d),e)}),g.trigger(a)}},isImage:function(a){return m(a)&&a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(a){return m(a)&&a.match(/\.(swf)((\?|#).*)?$/i)},_start:function(a){var b,d,e={};if(a=o(a),b=h.group[a]||null,!b)return!1;if(e=c.extend(!0,{},h.opts,b),b=e.margin,d=e.padding,"number"===c.type(b)&&(e.margin=[b,b,b,b]),"number"===c.type(d)&&(e.padding=[d,d,d,d]),e.modal&&c.extend(!0,e,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),e.autoSize&&(e.autoWidth=e.autoHeight=!0),"auto"===e.width&&(e.autoWidth=!0),"auto"===e.height&&(e.autoHeight=!0),e.group=h.group,e.index=a,h.coming=e,!1===h.trigger("beforeLoad"))h.coming=null;else{if(d=e.type,b=e.href,!d)return h.coming=null,!(!h.current||!h.router||"jumpto"===h.router)&&(h.current.index=a,h[h.router](h.direction));if(h.isActive=!0,"image"!==d&&"swf"!==d||(e.autoHeight=e.autoWidth=!1,e.scrolling="visible"),"image"===d&&(e.aspectRatio=!0),"iframe"===d&&k&&(e.scrolling="scroll"),e.wrap=c(e.tpl.wrap).addClass("fancybox-"+(k?"mobile":"desktop")+" fancybox-type-"+d+" fancybox-tmp "+e.wrapCSS).appendTo(e.parent||"body"),c.extend(e,{skin:c(".fancybox-skin",e.wrap),outer:c(".fancybox-outer",e.wrap),inner:c(".fancybox-inner",e.wrap)}),c.each(["Top","Right","Bottom","Left"],function(a,b){e.skin.css("padding"+b,p(e.padding[a]))}),h.trigger("onReady"),"inline"===d||"html"===d){if(!e.content||!e.content.length)return h._error("content")}else if(!b)return h._error("href");"image"===d?h._loadImage():"ajax"===d?h._loadAjax():"iframe"===d?h._loadIframe():h._afterLoad()}},_error:function(a){c.extend(h.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:a,content:h.coming.tpl.error}),h._afterLoad()},_loadImage:function(){var a=h.imgPreload=new Image;a.onload=function(){this.onload=this.onerror=null,h.coming.width=this.width/h.opts.pixelRatio,h.coming.height=this.height/h.opts.pixelRatio,h._afterLoad()},a.onerror=function(){this.onload=this.onerror=null,h._error("image")},a.src=h.coming.href,!0!==a.complete&&h.showLoading()},_loadAjax:function(){var a=h.coming;h.showLoading(),h.ajaxLoad=c.ajax(c.extend({},a.ajax,{url:a.href,error:function(a,b){h.coming&&"abort"!==b?h._error("ajax",a):h.hideLoading()},success:function(b,c){"success"===c&&(a.content=b,h._afterLoad())}}))},_loadIframe:function(){var a=h.coming,b=c(a.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",k?"auto":a.iframe.scrolling).attr("src",a.href);c(a.wrap).bind("onReset",function(){try{c(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(a){}}),a.iframe.preload&&(h.showLoading(),b.one("load",function(){c(this).data("ready",1),k||c(this).bind("load.fb",h.update),c(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),h._afterLoad()})),a.content=b.appendTo(a.inner),a.iframe.preload||h._afterLoad()},_preloadImages:function(){var a,b,c=h.group,d=h.current,e=c.length,f=d.preload?Math.min(d.preload,e-1):0;for(b=1;b<=f;b+=1)a=c[(d.index+b)%e],"image"===a.type&&a.href&&((new Image).src=a.href)},_afterLoad:function(){var a,b,d,e,f,g=h.coming,i=h.current;if(h.hideLoading(),g&&!1!==h.isActive)if(!1===h.trigger("afterLoad",g,i))g.wrap.stop(!0).trigger("onReset").remove(),h.coming=null;else{switch(i&&(h.trigger("beforeChange",i),i.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),h.unbindEvents(),a=g.content,b=g.type,d=g.scrolling,c.extend(h,{wrap:g.wrap,skin:g.skin,outer:g.outer,inner:g.inner,current:g,previous:i}),e=g.href,b){case"inline":case"ajax":case"html":g.selector?a=c("<div>").html(a).find(g.selector):l(a)&&(a.data("fancybox-placeholder")||a.data("fancybox-placeholder",c('<div class="fancybox-placeholder"></div>').insertAfter(a).hide()),a=a.show().detach(),g.wrap.bind("onReset",function(){c(this).find(a).length&&a.hide().replaceAll(a.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":a=g.tpl.image.replace("{href}",e);break;case"swf":a='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+e+'"></param>',f="",c.each(g.swf,function(b,c){a+='<param name="'+b+'" value="'+c+'"></param>',f+=" "+b+'="'+c+'"'}),a+='<embed src="'+e+'" type="application/x-shockwave-flash" width="100%" height="100%"'+f+"></embed></object>"}(!l(a)||!a.parent().is(g.inner))&&g.inner.append(a),h.trigger("beforeShow"),g.inner.css("overflow","yes"===d?"scroll":"no"===d?"hidden":d),h._setDimension(),h.reposition(),h.isOpen=!1,h.coming=null,h.bindEvents(),h.isOpened?i.prevMethod&&h.transitions[i.prevMethod]():c(".fancybox-wrap").not(g.wrap).stop(!0).trigger("onReset").remove(),h.transitions[h.isOpened?g.nextMethod:g.openMethod](),h._preloadImages()}},_setDimension:function(){var a,b,d,e,f,g,i,j,k,l=h.getViewport(),m=0,q=!1,r=!1,q=h.wrap,s=h.skin,t=h.inner,u=h.current,r=u.width,v=u.height,w=u.minWidth,x=u.minHeight,y=u.maxWidth,z=u.maxHeight,A=u.scrolling,B=u.scrollOutside?u.scrollbarWidth:0,C=u.margin,D=o(C[1]+C[3]),E=o(C[0]+C[2]);if(q.add(s).add(t).width("auto").height("auto").removeClass("fancybox-tmp"),C=o(s.outerWidth(!0)-s.width()),a=o(s.outerHeight(!0)-s.height()),b=D+C,d=E+a,e=n(r)?(l.w-b)*o(r)/100:r,f=n(v)?(l.h-d)*o(v)/100:v,"iframe"===u.type){if(k=u.content,u.autoHeight&&1===k.data("ready"))try{k[0].contentWindow.document.location&&(t.width(e).height(9999),g=k.contents().find("body"),B&&g.css("overflow-x","hidden"),f=g.outerHeight(!0))}catch(a){}}else(u.autoWidth||u.autoHeight)&&(t.addClass("fancybox-tmp"),u.autoWidth||t.width(e),u.autoHeight||t.height(f),u.autoWidth&&(e=t.width()),u.autoHeight&&(f=t.height()),t.removeClass("fancybox-tmp"));if(r=o(e),v=o(f),j=e/f,w=o(n(w)?o(w,"w")-b:w),y=o(n(y)?o(y,"w")-b:y),x=o(n(x)?o(x,"h")-d:x),z=o(n(z)?o(z,"h")-d:z),g=y,i=z,u.fitToView&&(y=Math.min(l.w-b,y),z=Math.min(l.h-d,z)),b=l.w-D,E=l.h-E,u.aspectRatio?(r>y&&(r=y,v=o(r/j)),v>z&&(v=z,r=o(v*j)),r<w&&(r=w,v=o(r/j)),v<x&&(v=x,r=o(v*j))):(r=Math.max(w,Math.min(r,y)),u.autoHeight&&"iframe"!==u.type&&(t.width(r),v=t.height()),v=Math.max(x,Math.min(v,z))),u.fitToView)if(t.width(r).height(v),q.width(r+C),l=q.width(),D=q.height(),u.aspectRatio)for(;(l>b||D>E)&&r>w&&v>x&&!(19<m++);)v=Math.max(x,Math.min(z,v-10)),r=o(v*j),r<w&&(r=w,v=o(r/j)),r>y&&(r=y,v=o(r/j)),t.width(r).height(v),q.width(r+C),l=q.width(),D=q.height();else r=Math.max(w,Math.min(r,r-(l-b))),v=Math.max(x,Math.min(v,v-(D-E)));B&&"auto"===A&&v<f&&r+C+B<b&&(r+=B),t.width(r).height(v),q.width(r+C),l=q.width(),D=q.height(),q=(l>b||D>E)&&r>w&&v>x,r=u.aspectRatio?r<g&&v<i&&r<e&&v<f:(r<g||v<i)&&(r<e||v<f),c.extend(u,{dim:{width:p(l),height:p(D)},origWidth:e,origHeight:f,canShrink:q,canExpand:r,wPadding:C,hPadding:a,wrapSpace:D-s.outerHeight(!0),skinSpace:s.height()-v}),!k&&u.autoHeight&&v>x&&v<z&&!r&&t.height("auto")},_getPosition:function(a){var b=h.current,c=h.getViewport(),d=b.margin,e=h.wrap.width()+d[1]+d[3],f=h.wrap.height()+d[0]+d[2],d={position:"absolute",top:d[0],left:d[3]};return b.autoCenter&&b.fixed&&!a&&f<=c.h&&e<=c.w?d.position="fixed":b.locked||(d.top+=c.y,d.left+=c.x),d.top=p(Math.max(d.top,d.top+(c.h-f)*b.topRatio)),d.left=p(Math.max(d.left,d.left+(c.w-e)*b.leftRatio)),d},_afterZoomIn:function(){var a=h.current;a&&(h.isOpen=h.isOpened=!0,h.wrap.css("overflow","visible").addClass("fancybox-opened"),h.update(),(a.closeClick||a.nextClick&&1<h.group.length)&&h.inner.css("cursor","pointer").bind("click.fb",function(b){!c(b.target).is("a")&&!c(b.target).parent().is("a")&&(b.preventDefault(),h[a.closeClick?"close":"next"]())}),a.closeBtn&&c(a.tpl.closeBtn).appendTo(h.skin).bind("click.fb",function(a){a.preventDefault(),h.close()}),a.arrows&&1<h.group.length&&((a.loop||0<a.index)&&c(a.tpl.prev).appendTo(h.outer).bind("click.fb",h.prev),(a.loop||a.index<h.group.length-1)&&c(a.tpl.next).appendTo(h.outer).bind("click.fb",h.next)),h.trigger("afterShow"),a.loop||a.index!==a.group.length-1?h.opts.autoPlay&&!h.player.isActive&&(h.opts.autoPlay=!1,h.play()):h.play(!1))},_afterZoomOut:function(a){a=a||h.current,c(".fancybox-wrap").trigger("onReset").remove(),c.extend(h,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),h.trigger("afterClose",a)}}),h.transitions={getOrigPosition:function(){var a=h.current,b=a.element,c=a.orig,d={},e=50,f=50,g=a.hPadding,i=a.wPadding,j=h.getViewport();return!c&&a.isDom&&b.is(":visible")&&(c=b.find("img:first"),c.length||(c=b)),l(c)?(d=c.offset(),c.is("img")&&(e=c.outerWidth(),f=c.outerHeight())):(d.top=j.y+(j.h-f)*a.topRatio,d.left=j.x+(j.w-e)*a.leftRatio),("fixed"===h.wrap.css("position")||a.locked)&&(d.top-=j.y,d.left-=j.x),d={top:p(d.top-g*a.topRatio),left:p(d.left-i*a.leftRatio),width:p(e+i),height:p(f+g)}},step:function(a,b){var c,d,e=b.prop;d=h.current;var f=d.wrapSpace,g=d.skinSpace;"width"!==e&&"height"!==e||(c=b.end===b.start?1:(a-b.start)/(b.end-b.start),h.isClosing&&(c=1-c),d="width"===e?d.wPadding:d.hPadding,d=a-d,h.skin[e](o("width"===e?d:d-f*c)),h.inner[e](o("width"===e?d:d-f*c-g*c)))},zoomIn:function(){var a=h.current,b=a.pos,d=a.openEffect,e="elastic"===d,f=c.extend({opacity:1},b);delete f.position,e?(b=this.getOrigPosition(),a.openOpacity&&(b.opacity=.1)):"fade"===d&&(b.opacity=.1),h.wrap.css(b).animate(f,{duration:"none"===d?0:a.openSpeed,easing:a.openEasing,step:e?this.step:null,complete:h._afterZoomIn})},zoomOut:function(){var a=h.current,b=a.closeEffect,c="elastic"===b,d={opacity:.1};c&&(d=this.getOrigPosition(),a.closeOpacity&&(d.opacity=.1)),h.wrap.animate(d,{duration:"none"===b?0:a.closeSpeed,easing:a.closeEasing,step:c?this.step:null,complete:h._afterZoomOut})},changeIn:function(){var a,b=h.current,c=b.nextEffect,d=b.pos,e={opacity:1},f=h.direction;d.opacity=.1,"elastic"===c&&(a="down"===f||"up"===f?"top":"left","down"===f||"right"===f?(d[a]=p(o(d[a])-200),e[a]="+=200px"):(d[a]=p(o(d[a])+200),e[a]="-=200px")),"none"===c?h._afterZoomIn():h.wrap.css(d).animate(e,{duration:b.nextSpeed,easing:b.nextEasing,complete:h._afterZoomIn})},changeOut:function(){var a=h.previous,b=a.prevEffect,d={opacity:.1},e=h.direction;"elastic"===b&&(d["down"===e||"up"===e?"top":"left"]=("up"===e||"left"===e?"-":"+")+"=200px"),a.wrap.animate(d,{duration:"none"===b?0:a.prevSpeed,easing:a.prevEasing,complete:function(){c(this).trigger("onReset").remove()}})}},h.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!k,fixed:!0},overlay:null,fixed:!1,el:c("html"),create:function(a){a=c.extend({},this.defaults,a),this.overlay&&this.close(),this.overlay=c('<div class="fancybox-overlay"></div>').appendTo(h.coming?h.coming.parent:a.parent),this.fixed=!1,a.fixed&&h.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(a){var b=this;a=c.extend({},this.defaults,a),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(a),this.fixed||(f.bind("resize.overlay",c.proxy(this.update,this)),this.update()),a.closeClick&&this.overlay.bind("click.overlay",function(a){if(c(a.target).hasClass("fancybox-overlay"))return h.isActive?h.close():b.close(),!1}),this.overlay.css(a.css).show()},close:function(){var a,b;f.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&(c(".fancybox-margin").removeClass("fancybox-margin"),a=f.scrollTop(),b=f.scrollLeft(),this.el.removeClass("fancybox-lock"),f.scrollTop(a).scrollLeft(b)),c(".fancybox-overlay").remove().hide(),c.extend(this,{overlay:null,fixed:!1})},update:function(){var a,c="100%";this.overlay.width(c).height("100%"),i?(a=Math.max(b.documentElement.offsetWidth,b.body.offsetWidth),g.width()>a&&(c=g.width())):g.width()>f.width()&&(c=g.width()),this.overlay.width(c).height(g.height())},onReady:function(a,b){var d=this.overlay;c(".fancybox-overlay").stop(!0,!0),d||this.create(a),a.locked&&this.fixed&&b.fixed&&(d||(this.margin=g.height()>f.height()&&c("html").css("margin-right").replace("px","")),b.locked=this.overlay.append(b.wrap),b.fixed=!1),!0===a.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(a,b){var d,e;b.locked&&(!1!==this.margin&&(c("*").filter(function(){return"fixed"===c(this).css("position")&&!c(this).hasClass("fancybox-overlay")&&!c(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),d=f.scrollTop(),e=f.scrollLeft(),this.el.addClass("fancybox-lock"),f.scrollTop(d).scrollLeft(e)),this.open(a)},onUpdate:function(){this.fixed||this.update()},afterClose:function(a){this.overlay&&!h.coming&&this.overlay.fadeOut(a.speedOut,c.proxy(this.close,this))}},h.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(a){var b=h.current,d=b.title,e=a.type;if(c.isFunction(d)&&(d=d.call(b.element,b)),m(d)&&""!==c.trim(d)){switch(b=c('<div class="fancybox-title fancybox-title-'+e+'-wrap">'+d+"</div>"),e){case"inside":e=h.skin;break;case"outside":e=h.wrap;break;case"over":e=h.inner;break;default:e=h.skin,b.appendTo("body"),i&&b.width(b.width()),b.wrapInner('<span class="child"></span>'),h.current.margin[2]+=Math.abs(o(b.css("margin-bottom")))}b["top"===a.position?"prependTo":"appendTo"](e)}}},c.fn.fancybox=function(a){var b,d=c(this),e=this.selector||"",f=function(f){var g,i,j=c(this).blur(),k=b;!f.ctrlKey&&!f.altKey&&!f.shiftKey&&!f.metaKey&&!j.is(".fancybox-wrap")&&(g=a.groupAttr||"data-fancybox-group",i=j.attr(g),i||(g="rel",i=j.get(0)[g]),i&&""!==i&&"nofollow"!==i&&(j=e.length?c(e):d,j=j.filter("["+g+'="'+i+'"]'),k=j.index(this)),a.index=k,!1!==h.open(j,a)&&f.preventDefault())};return a=a||{},b=a.index||0,e&&!1!==a.live?g.undelegate(e,"click.fb-start").delegate(e+":not('.fancybox-item, .fancybox-nav')","click.fb-start",f):d.unbind("click.fb-start").bind("click.fb-start",f),this.filter("[data-fancybox-start=1]").trigger("click"),this},g.ready(function(){var b,f;if(c.scrollbarWidth===d&&(c.scrollbarWidth=function(){var a=c('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),b=a.children(),b=b.innerWidth()-b.height(99).innerWidth();return a.remove(),b}),c.support.fixedPosition===d){b=c.support,f=c('<div style="position:fixed;top:20px;"></div>').appendTo("body");var g=20===f[0].offsetTop||15===f[0].offsetTop;f.remove(),b.fixedPosition=g}c.extend(h.defaults,{scrollbarWidth:c.scrollbarWidth(),fixed:c.support.fixedPosition,parent:c("body")}),b=c(a).width(),e.addClass("fancybox-lock-test"),f=c(a).width(),e.removeClass("fancybox-lock-test"),c("<style type='text/css'>.fancybox-margin{margin-right:"+(f-b)+"px;}</style>").appendTo("head")})}(window,document,jQuery),function(a){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.pym=a.call(this)}(function(){var a="xPYMx",b={},c=function(a){var b=new RegExp("[\\?&]"+a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},d=function(a,b){if("*"===b.xdomain||a.origin.match(new RegExp(b.xdomain+"$")))return!0},e=function(b,c,d){var e=["pym",b,c,d];return e.join(a)},f=function(b){var c=["pym",b,"(\\S+)","(.+)"];return new RegExp("^"+c.join(a)+"$")},g=function(){for(var a=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),c=a.length,d=0;d<c;++d){var e=a[d];e.setAttribute("data-pym-auto-initialized",""),""===e.id&&(e.id="pym-"+d);var f=e.getAttribute("data-pym-src"),g=e.getAttribute("data-pym-xdomain"),h={};g&&(h.xdomain=g),new b.Parent(e.id,f,h)}};return b.Parent=function(a,b,c){this.id=a,this.url=b,this.el=document.getElementById(a),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=f(this.id),this.messageHandlers={},this._constructIframe=function(){var a=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var b="",c=this.url.indexOf("#");c>-1?(b=this.url.substring(c,this.url.length),this.url=this.url.substring(0,c)):b=window.location.hash,this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+a+"&childId="+this.id+b,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.el.appendChild(this.iframe);var d=this;window.addEventListener("resize",function(){d.sendWidth()})},this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)},this._processMessage=function(a){if(d(a,this.settings)&&"undefined"!=typeof a.data.match){var b=a.data.match(this.messageRegex);if(!b||3!==b.length)return!1;var c=b[1],e=b[2];this._fire(c,e)}},this._onHeightMessage=function(a){var b=parseInt(a);this.iframe.setAttribute("height",b+"px")},this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this.sendMessage=function(a,b){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(e(this.id,a,b),"*")},this.sendWidth=function(){var a=this.el.offsetWidth.toString();this.sendMessage("width",a)};for(var g in c)this.settings[g]=c[g];this.onMessage("height",this._onHeightMessage);var h=this;return window.addEventListener("message",function(a){return h._processMessage(a)},!1),this._constructIframe(),this.onMessage("setFragmentId",function(a){"pushState"in history&&("#"===a&&(a=window.location.pathname+window.location.search),history.pushState("pym:"+this.id+":"+a,null,a))}),this},b.Child=function(b){this.parentWidth=null,this.id=null,this.settings={renderCallback:null,xdomain:"*",polling:0},this.messageRegex=null,this.messageHandlers={},this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]),this.messageHandlers[a].push(b)},this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)},this._processMessage=function(a){if(d(a,this.settings)){var b=a.data.match(this.messageRegex);if(b&&3===b.length){var c=b[1],e=b[2];this._fire(c,e)}}},this.sendMessage=function(a,b){window.top.postMessage(e(this.id,a,b),"*")},this.sendHeight=function(){var a=document.getElementsByTagName("body")[0].offsetHeight.toString();this.sendMessage("height",a)},this._onWidthMessage=function(a){var b=parseInt(a);b!==this.parentWidth&&(this.parentWidth=b,this.settings.renderCallback&&this.settings.renderCallback(b),this.sendHeight())},this.id=c("childId"),this.messageRegex=new RegExp("^pym"+a+this.id+a+"(\\S+)"+a+"(.+)$");var f=parseInt(c("initialWidth"));this.onMessage("width",this._onWidthMessage);for(var g in b)this.settings[g]=b[g];var h=this;return window.addEventListener("message",function(a){h._processMessage(a)},!1),this.settings.renderCallback&&this.settings.renderCallback(f),this.sendHeight(),this.settings.polling&&window.setInterval(this.sendHeight,this.settings.polling),this},g(),b}),function(a){function b(a){d&&(e.value&&d.classList.contains("search-form-open")||(a.preventDefault(),d.classList.contains("search-form-open")?(d.classList.remove("search-form-open"),e.blur(),f.blur()):(d.classList.add("search-form-open"),e.focus())))}function c(a){d&&g&&(a.preventDefault(),document.documentElement.classList.contains("nav-global-is-open")?(document.documentElement.classList.remove("nav-global-is-open"),g.textContent="Menu",g.blur()):(document.documentElement.classList.add("nav-global-is-open"),g.textContent="Close"))}var d=document.getElementById("header-global"),e=(document.getElementById("searchform"),document.getElementById("search-field")),f=document.getElementById("search-button"),g=document.getElementById("nav-global-toggle");document.getElementById("site-logo"),a.location.protocol+"//"+a.location.hostname;d&&(f&&f.addEventListener("click",b),g&&g.addEventListener("click",c),a.onpageshow=function(a){a.persisted&&document.documentElement.classList.contains("nav-global-is-open")&&(document.documentElement.classList.remove("nav-global-is-open"),g.textContent="Menu",g.blur())})}(window),function(a,b){function c(c){j.removeClass("hide-desktop"),j.show(),k.css({visibility:"hidden"}),l.css({visibility:"hidden"}),b("#part"+c+"-link").addClass("active"),a.history.replaceState({},"","#part"+c)}function d(){j.length&&(j.addClass("hide-desktop"),j.removeAttr("style")),k.length&&k.addClass("hide-mobile"),l.length&&l.addClass("hide-mobile")}function e(){var e,i,j,k=!1;if(m&&(a.innerWidth<600?a.scrollY<46?f.style.top=46-a.scrollY+"px":f.style.top=0:f.style.top=""),h){for(e=jQuery("nav.parts a").length,f.classList.remove("inverse"),g.find("nav a").removeClass("active"),i=e;i>0;i--)if(j="#part"+i,b(j).length&&b(a).scrollTop()>b(j).offset().top-120){c(i),k=!0;break}k||(d(),"hidden"===b("header svg.vertical, header svg.header-global-logo").css("visibility")&&b("header svg.vertical, header svg.header-global-logo").css({opacity:0,visibility:"visible"}).animate({opacity:1},"slow"),f.classList.add("inverse"),g.find("nav a").removeClass("active"))}}var f=document.querySelector("#header-global-simple header"),g=b(f),h=g.find("nav.parts"),i=g.find("nav.parts a"),j=g.find("svg.fox-head"),k=g.find("svg.vertical"),l=g.find("svg.header-global-logo"),m=document.body.classList.contains("admin-bar");if(f){if(document.querySelector(".single-fte_interactives"))return d(),!1;i.length&&i.on("click",function(c){var d=b(this).attr("href");
b(a).scrollTop(b(d).offset().top-(10+jQuery("header").height()+jQuery("#wpadminbar").height())),c.preventDefault(),a.history.replaceState({},"",d)}),b(a).on("scroll",e),b(a).on("resize",e),e()}}(window,jQuery),function(a,b){function c(){!1===j&&(g.addClass("sticky"),g.find("a[name]").each(function(){var a=b(this),c=b(this).attr("name");a.attr("name",c+"-sticky")}),l.hasClass("home")&&l.on("click.fox",".header-global-logo-link",function(a){a.preventDefault(),b("html, body").animate({scrollTop:0},1e3)}),l.hasClass("tax-fte_verticals")&&l.on("click.vertical",".-current-vertical a",function(a){a.preventDefault(),b("html, body").animate({scrollTop:0},1e3)}))}function d(){!0===j&&(g.removeClass("sticky"),g.find("a[name]").each(function(){var a=b(this),c=b(this).attr("name"),d=c.replace("-sticky","");a.attr("name",d)}),l.hasClass("home")&&l.off("click.fox",".header-global-logo-link"),l.hasClass("tax-fte_verticals")&&l.off("click.vertical",".-current-vertical a"))}function e(){b(a).scrollTop()>h+i?(c(),j=!0):(d(),j=!1)}function f(b){var c=b.keyCode,d=60,e=a.innerHeight,f=document.getElementById("wpadminbar"),g=f?f.offsetHeight:0;!n||33!==c&&34!==c||(b.preventDefault(),33===c?a.scrollBy(0,0-(e-d-g-10)):34===c&&a.scrollBy(0,e-d-g-10))}var g,h,i,j,k,l,m,n=document.getElementById("header-global");document.getElementById("header-global")&&"object"!=typeof a.LivepressConfig&&(g=b(n),h=g.offset().top,i=g.outerHeight(!0),j=!1,l=b("body"),g.parent(".header-global-wrapper").length||g.wrapAll('<div class="header-global-wrapper" style="height: '+i+'px;"></div>'),k=_.throttle(e,50),b(a).on("scroll.stickyNav",k),a.addEventListener("keydown",f),b(".share-sticky").on("click",function(c){var d=void 0!==a.screenLeft?a.screenLeft:screen.left,e=void 0!==a.screenTop?a.screenTop:screen.top,f=a.innerWidth?a.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,g=a.innerHeight?a.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,h=f/2-300+d,i=g/2-200+e;return"undefined"!=typeof a.windowOpen&&a.windowOpen.close(),a.open(b(this).attr("href"),"wpcomfacebook","menubar=1,resizable=1,width=600,height=400,top="+i+",left="+h),!1}),b(document).on("ready",function(){l.hasClass("single")&&g.find(".-current-vertical").length&&(m=g.find(".-current-vertical a").clone(),b(".single-sticky-vertical").append(m))}))}(window,jQuery),function(a,b){"use strict";function c(c,d,e){var f,g,h,i,j,k,l,m=a(c.currentTarget);i=e?".widget":".page",f=a(i+".newsletter-modal .newsletter-signup-response"),h=a(i+".newsletter-modal .newsletter-success"),g=a(i+".newsletter-modal .newsletter-main-copy"),k=m.serializeArray(),k.push({name:"action",value:"sailthru_subscribe"}),l=wp.ajax.post("sailthru_subscribe",k),l.done(function(c){j=b.setInterval(function(){a.fancybox.update()},20),g.fadeOut("fast"),m.slideUp("slow",function(){f.hide(),h.fadeIn("fast",function(){b.clearInterval(j)}),a.fancybox.update()})}),l.fail(function(c){var d;"string"==typeof c?d=c:"object"==typeof c?"undefined"!=typeof c.errormsg?d=c.errormsg:"undefined"!=typeof c.statusText?d=c.statusText:(d="An unknown error occurred.",b.console.log(c)):(d="An unknown error occurred.",b.console.log(c)),e?(f.addClass("error").hide().html(d).fadeIn("slow"),a.fancybox.update()):f.addClass("error").html(d)})}var d=a(".btn-newsletter, #footer-newsletter-signup");d.length&&(d.on("click",function(b){a.fancybox.open(a(".widget.newsletter-modal"),{fitToView:!0,autoSize:!1,autoHeight:!0,maxWidth:"600px",closeBtn:!1,closeClick:!1,openEffect:"none",closeEffect:"none",wrapCSS:"newsletter",afterShow:function(b){a("body").hasClass("touch")&&(a(".fancybox-overlay").appendTo(".fancybox-wrap"),a(".fancybox-overlay").removeClass("fancybox-overlay-fixed"))},afterClose:function(b){var c=a(b.element).find("form"),d=a(b.element).find("#newsletter-main-copy"),e=a(b.element).find(".newsletter-success");a(b.element).find("#newsletter-signup-response").hide(),d.show(),e.hide(),c.trigger("reset"),c.show()}})}),a(".btn-newsletter, #footer-newsletter-signup").on("click",function(a){a.preventDefault()}),a(".close-newsletter").on("click",function(b){b.preventDefault(),a.fancybox.close()}),a("#sailthru-signup-page").submit(function(a,b){c(a,b,!1),a.preventDefault()}),a("#sailthru-signup-widget").submit(function(a,b){c(a,b,!0),a.preventDefault()}))}(jQuery,this),window.espn.trackOutbrain=function(a){var b,c=document.querySelector(a);c&&(b=new MutationObserver(function(b){jQuery(a+" li a.ob-dynamic-rec-link").each(function(a,b){jQuery(b).attr("name","&lpos=fivethirtyeight&lid=outbrain:recommended:story"+(a+1))})}),b.observe(c,{childList:!0,subtree:!0}))},window.espn.activateOutbrainRecommendations=function(a){a.each(function(){jQuery(this).is(":visible")&&(jQuery(this).removeClass("outbrain-placeholder").addClass("OUTBRAIN"),OBR.extern.researchWidget())})},window.espn.activateStickyHeaderOutbrain=function(){var a,b=document.querySelector("body"),c=document.querySelector(".header-global");a=new MutationObserver(function(a){var b;jQuery("body").hasClass("sticky-recommended")&&(b=jQuery(".header-global .recommended .outbrain-placeholder"),b.length&&(b.removeClass("outbrain-placeholder").addClass("OUTBRAIN"),OBR.extern.researchWidget()))}),a.observe(b,{attributes:!0}),a.observe(c,{attributes:!0})},jQuery(document).ready(function(){var a;return"undefined"!=typeof OBR&&(a=jQuery(".entry-content .outbrain-recommendations"),a.length&&(window.espn.activateOutbrainRecommendations(a),jQuery(window).on("resize",window.espn.activateOutbrainRecommendations)),window.espn.activateStickyHeaderOutbrain(),void window.espn.trackOutbrain(".widget.fivethirtyeight-outbrain"))}),function(a,b){"use strict";function c(b,c){var d={title:".fte-expandable-title",body:".fte-expandable-content",onOpen:function(){},onClose:function(){},onInit:function(){}};this.element=b,this.options=a.extend({},d,c),this.init()}function d(b,c){var d={title:".fte-tabs-title",body:".fte-tabs-content"};this.element=b,this.options=a.extend({},d,c),this.init()}function e(b,c){var d={container:".fte-sameheightcol",cells:".col-ab"};this.element=b,this.options=a.extend({},d,c),this.init()}function f(b,c){var d={marginTop:20,fullHeight:!1};this.element=b,this.options=a.extend({},d,c),this.init()}function g(){a(".fte-expandable").expandable({onInit:function(){},onOpen:function(){var b,c,d;a(this.element).parent(".blog-stream").length&&("undefined"!=typeof espn.affinity_video&&espn.affinity_video.initialize_players(a("body")),b=a(this.element).children(".fte-expandable-title").find(".post-head"),c=b.siblings(".fte-expandable-icon"),d=c.offset().left,a(this.element).waypoint(function(b){c.attr("style",""),a(".fte-fix-icon").removeClass("fte-fix-icon"),"down"===b&&(c.css("left",d+"px"),a(this).addClass("fte-fix-icon"))}),a(this.element).waypoint(function(b){"down"===b?(c.attr("style",""),a(this).removeClass("fte-fix-icon")):(c.css("left",d+"px"),a(this).addClass("fte-fix-icon"))},{offset:function(){return-a(this).height()+20}}))},onClose:function(){a(this.element).parent(".blog-stream").length&&(a(".fte-fix-icon").removeClass("fte-fix-icon"),a(this.element).waypoint("destroy"))}})}var h,i,j,k;h=function(){return a(b).width()<768},i=function(){return a(b).width()<1024},j=function(){return"ontouchstart"in b||b.navigator.msMaxTouchPoints},c.prototype={currentBaseUrl:b.location.href,init:function(){var b=this,c=a(b.element).children(b.options.title);c.on("click",function(a){a.preventDefault(),b.fteToggle(this)}).append('<span class="fte-expandable-icon"></span>'),a(b.element).find(".metadata").length&&(c.on("click",function(a){c.stop().fadeTo(100,.4).fadeTo(300,1)}),c.on("click",".topic a",function(a){a.stopPropagation()}),c.on("click",".metadata a",function(a){a.stopPropagation()}),c.on("click",".fte-expandable-icon",function(a){a.stopPropagation(),a.preventDefault(),c.find(".article-title a").trigger("click")}),c.on("click",".metadata span.share a",function(b){var c=a(this).position().left+a(this).width()+5,d=a(this).parents(".metadata").next("div.share");b.preventDefault(),a("div.share").not(d).hide(),d.css("left",c+"px").toggle()})),a('[data-expandable="'+this.element.id+'"]').on("click",function(a){b.fteOpen(this,0)}),b.options.onInit.call(b)},fteChangeStateOnOpen:function(a){b.history.replaceState({caller:"fiveThirtyEight"},"blog-stream-location",a)},fteChangeStateOnClose:function(){b.history.replaceState({caller:"fiveThirtyEight"},"blog-stream-location-base",this.currentBaseUrl)},fteOpen:function(c,d){var e=this,f=a(c).data("close-text");d="undefined"!=typeof d?d:600,f&&a(c).html(f+'<span class="fte-expandable-icon"></span>'),a(this.element).addClass("fte-expandable-open").children(this.options.body).animate({opacity:"show",height:"show"},d,function(){a(b).trigger("resize"),e.options.onOpen.call(e)}),this.fteChangeStateOnOpen(a(this.element).find(".article-title a").attr("href")),a(this.element).parents(".single-col").length?a(this.element).parents(".single-col").css("height","auto"):a(b).trigger("resize")},fteClose:function(c,d){var e=this,f=a(c).data("open-text");d="undefined"!=typeof d?d:600,f&&a(c).html(f+'<span class="fte-expandable-icon"></span>'),this.fteChangeStateOnClose(),a(this.element).removeClass("fte-expandable-open").children(this.options.body).animate({opacity:"hide",height:"hide"},d,function(){a(b).trigger("resize"),e.options.onClose.call(e)})},fteToggle:function(b){a(this.element).hasClass("fte-expandable-open")?this.fteClose(b):this.fteOpen(b)}},d.prototype={init:function(){var b=this,c=a(b.element).find(b.options.title);c.find("li").first().addClass("active"),c.find("li").on("click",function(a){a.preventDefault(),b.fteShow(this)})},fteShow:function(c){var d=a("a",c).attr("href");a(c).addClass("active").siblings("li").removeClass("active"),a(d,this.element).show().siblings("div").hide(),a(b).trigger("resize")}},e.prototype={init:function(){var c=this;c.fteMakeRow(),a(b).on("resize.col load.col",function(){c.fteMakeRow()})},fteMakeRow:function(){var c,d,e,f=a(this.element).find(this.options.cells),g=a(this.element).data("col");if(f.css("min-height","0"),a(b).width()>768)for(c=0;c<f.length;c++)if(0===c%g){for(e=a(f[c]),d=1;d<g;d++)e=e.add(f[c+d]);this.fteEqualize(e),c===f.length-2&&e.addClass("last-row")}},fteEqualize:function(c){var d,e,f=[];a.each(c,function(b,c){d=a(c),e=d.height(),f.push(e)}),c.css("min-height",Math.max.apply(b,f))}},f.prototype={init:function(){var c,d,e,f,g=this,h=a(g.element);a(b).on("resize.col load.col",function(){c=h.parent().offset().top,g.options.fullHeight&&h.height(a(b).height()-a("#wpadminbar").height())}),a(b).on("scroll.sticky load.sticky",function(i){a(b).width()>768&&(e=a(b).scrollTop(),f=a(b).scrollTop()+h.height()+g.options.marginTop,d=a(".single-navigation-bottom").length?a(".single-navigation-bottom").offset().top:a("#colophon").offset().top,e>c-g.options.marginTop?(h.addClass("fte-fixed"),g.options.fullHeight&&h.height("100%"),f>=d&&!g.options.fullHeight?h.addClass("fte-fixed-bottom"):f>=d&&g.options.fullHeight?(h.height(d-e),h.css("top",0),h.css("bottom","auto")):a(b.document).height()-(e+a(b).height())<a("#colophon").outerHeight()&&g.options.fullHeight?h.height(a(b).height()-(a("#colophon").outerHeight()-(a(b.document).height()-(e+a(b).height())))-a("#wpadminbar").height()):h.removeClass("fte-fixed-bottom")):(h.removeClass("fte-fixed"),g.options.fullHeight&&(h.attr("style",""),h.height(a(b).height()-a("#wpadminbar").height()))))})}},a.extend(a.fn,{expandable:function(b){return this.each(function(){a.data(this,"fte_expandable")||a.data(this,"fte_expandable",new c(this,b))})},tabs:function(b){return this.each(function(){a.data(this,"fte_tabs")||a.data(this,"fte_tabs",new d(this,b))})},sameheightcol:function(b){return this.each(function(){a.data(this,"fte_sameheightcol")?new e(this,b):a.data(this,"fte_sameheightcol",new e(this,b))})},sticky:function(b){return this.each(function(){a.data(this,"fte_sticky")||a.data(this,"fte_sticky",new f(this,b))})}}),g(),a(".fte-tabs").tabs(),a(".fte-sameheightcol").sameheightcol(),a(".vertical #main").sameheightcol({container:"#main",cells:".vertical-col"}),a(".home .row-ab").sameheightcol({container:".row-ab",cells:".home-col"}),a(".archive").not(".post-type-archive-fte_datalab").find("#content").sameheightcol({container:"#content",cells:".single-col"}),a("#social-widget").sticky(),a(".blog .metadata").length&&a("body").on("click",function(b){a("div.share").hide()}),a(".post-thumbnail").length&&(k=a(".post-thumbnail"),k.on("mouseenter",function(b){a(this).parents(".hentry,.hentry-archive").addClass("hovered")}).on("mouseleave",function(b){a(this).parents(".hentry,.hentry-archive").removeClass("hovered")})),a("body").on("readMoreChange.fiveThirtyEight",function(c){g(),FB.XFBML.parse(b.document.body),a(b).trigger("resize")}),a(b).load(function(){var b=a(".fivethirtyeight-sidebar-ad");b.find(".ad-wrapper").height()<20&&b.addClass("ad-not-loaded")}),j()&&a("body").addClass("touch"),a(b).width()>768?a(".featured-image-link").fancybox({maxWidth:800,fitToView:!1,width:"70%",height:"70%",autoSize:!0,closeClick:!1,openEffect:"none",closeEffect:"none"}):a(".featured-image-link").on("click",function(c){var d=a(this).attr("href");c.preventDefault(),b.location=a(d).attr("href")}),a(".overlay[data-href]").on("click",function(c){b.location=a(this).data("href")}),a(".has-bugs").each(function(b){a(this).addClass("has-bugs-loaded")}),a("a.fte-email-share").removeAttr("target"),0===document.referrer.indexOf("https://t.co/")&&a("body").addClass("via-twitter"),a(".recirc.tease").each(function(c){a(this).on("click",function(c){b.location=a(this).find("a").attr("href")})})}(jQuery,this),function(a,b){b(a.document).on("click",".entry-content a, .entry-footnotes a",function(a){var c=b(this).attr("href");c&&0!==c.indexOf("mailto:")&&(c.match(/^[#\/]+|(https?:)?\/\/(projects\.)?fivethirtyeight\.com/)?b(this).removeAttr("target"):b(this).attr("target","_blank"))})}(window,jQuery),function(a,b){jQuery(".widget.embed iframe").hover(function(){b(this).parent().find("h3 a").addClass("underlined")},function(){b(this).parent().find("h3 a").removeClass("underlined")})}(window,jQuery),window.espn.recircGetHeight=function(){var a=[".entry-content","article.hentry .post-info","article.hentry .post-thumbnail","article.hentry-archive .post-thumbnail"],b=[".entry-footnotes",".mini-bio","#outbrain-container","p.tags","#entry-comments h3"],c=0;for(window.espn.recircTopHeight=49,window.espn.recircBottomHeight=132,c=0;c<a.length;c++)window.espn.recircTopHeight+=jQuery(a[c]).height();for(c=0;c<b.length;c++)window.espn.recircBottomHeight+=jQuery(b[c]).height();return window.espn.recircTopHeight},window.espn.showSidebar=function(){jQuery(".sidebar-feature").removeClass("visually-hidden")},window.espn.recircSetHeights=function(){var a=0,b=!1,c=!1,d=!1;jQuery("#secondary .filler").remove(),window.espn.recircGetHeight(),b=window.espn.recircTopHeight<1300,c=window.espn.recircTopHeight>2600,d=window.espn.recircTopHeight>3900,a=window.espn.recircTopHeight+window.espn.recircBottomHeight,b&&(a-=49),jQuery("#secondary").height(a).css("min-height",""),b?jQuery("#secondary").addClass("short"):(d?jQuery("#secondary").addClass("extralong"):c?jQuery("#secondary").addClass("long"):jQuery("#secondary").addClass("medium"),jQuery("#secondary").append('<div class="filler"></div>'),jQuery("#secondary .filler").height(window.espn.recircBottomHeight)),window.espn.showSidebar()},jQuery(document).ready(function(){var a,b,c;if(document.getElementById("secondary")&&jQuery(".single-fte_features,.single-fte_datalab").length){if(document.referrer&&document.referrer.indexOf("espn.com")>0&&(b=jQuery(".sidebar-feature"),c=jQuery(".sidebar-feature-espn"),b.length&&c.length&&jQuery("body").addClass("via-espn")),window.espn.trackOutbrain(".widget.fivethirtyeight-outbrain"),"undefined"!=typeof OBR&&(a=jQuery(".widget.fivethirtyeight-outbrain .outbrain-placeholder"),a.length&&(a.removeClass("outbrain-placeholder").addClass("OUTBRAIN"),OBR.extern.researchWidget())),jQuery("body.touch").length)return void window.espn.showSidebar();window.espn.recircSetHeights(),window.addEventListener("resize",window.espn.recircSetHeights)}}),window.espn.setVideoHeight=function(){jQuery(".video-placeholder").each(function(){jQuery(this).height(jQuery(this).width()/(16/9))})},function(a,b){a.espn.setVideoHeight(),b(a).on("resize",a.espn.setVideoHeight)}(window,jQuery),function(a,b){function c(){var a,b,c,e,f,g,h,i,j,k,l=document.querySelectorAll(".livepress-update"),m=d.querySelector(".livepress-update:not(.pinned-first-live-update) .livepress-meta .livepress-update-header-timestamp abbr"),n=!1;m&&(c=jQuery(m).data("timestamp"),c&&(e=new Date(c),e&&(f=parseInt(e.getHours(),10),g=parseInt(e.getMinutes(),10),h=f>=12?"pm":"am",f>12&&(f-=12),g<10&&(g="0"+g),document.getElementById("updated-at-time").innerText=f+":"+g+" "+h,jQuery.datepicker&&jQuery.datepicker.formatDate&&(document.getElementById("updated-at-date").innerText=jQuery.datepicker.formatDate("M d, yy",e))))),_.each(l,function(c){c.querySelector(".live-update-authors ~ .livepress-meta")||(a=c.querySelector(".live-update-authors"),b=c.querySelector(".livepress-meta"),i=[],j=[],a&&(a&&b&&(a.parentNode.removeChild(a),b.parentNode.insertBefore(a,b),j=c.querySelectorAll(".live-author-name"),j.length&&_.each(j,function(a){-1===a.textContent.indexOf("Twitter")?i.push(a.innerHTML):n=!0})),0===i.length&&n?c.querySelector(".livepress-meta").innerHTML="":(k=c.querySelector(".livepress-update-author"),k&&(k.innerHTML=i.join(", ")))))})}var d,e;document.body.classList.contains("single-fte_liveblog")&&(d=document.getElementById("post_content_livepress"),d&&(c(),e=new MutationObserver(function(a){c()}),e.observe(d,{childList:!0})))}(this,jQuery),function(a,b){b(a.document).on("live_post_update",function(){var c,d;espn.affinity_video.initialize_players(b("body")),setTimeout(a.espn.setVideoHeight,100),b(".DV-container").each(function(e,f){b(f).data("loaded")||"undefined"!=typeof a.DV&&(c=b(f).data("href"),d=b(f).data("attrs"),c&&d&&(a.DV.load(c,d),b(f).data("loaded",!0)))})})}(this,jQuery),function(a,b){b(".sponsored-disclaimer").length&&(b(".sponsored-heading span").on("mouseenter",function(a){b(".sponsored-disclaimer").toggleClass("shown")}),b(".sponsored-heading span, .sponsored-disclaimer").on("mouseleave",function(a){b(".sponsored-disclaimer").removeClass("shown")}))}(window,jQuery),function(a,b){function c(a){a.stopPropagation(),a.preventDefault(),h.classList.contains("additional-info-opened")?h.classList.remove("additional-info-opened"):(h.classList.add("additional-info-opened"),b("html, body").animate({scrollTop:b(g).offset().top},1e3)),e.blur()}function d(a){a.stopPropagation(),a.preventDefault(),h.classList.remove("additional-info-opened")}var e=document.getElementById("additional-info-toggle"),f=document.getElementById("close-additional-info"),g=document.getElementById("footer-additional-info"),h=document.getElementById("colophon");e&&g&&f&&h&&(e.addEventListener("click",c,!1),f.addEventListener("click",d,!1))}(window,jQuery),function(a){function b(b){var c=b.target.getAttribute("data-href")||b.target.parentNode.getAttribute("data-href");b.target.classList.contains("js-link-desktop-only")&&a.innerWidth<768||c&&(a.location=c)}var c=document.querySelectorAll(".js-link, .js-link .post-info");c&&_.each(c,function(a){a.addEventListener("click",b)})}(window),function(a){function b(a){a&&(this.podcastContainer=a,this.postTitle=a.querySelector(".title a"),this.playButton=a.querySelector(".play"),this.progressBar=a.querySelector(".progressbar"),this.progress=a.querySelector(".progress"),this.counter=a.querySelector(".counter"),this.audio=a.querySelector(".audio"),this.audio&&(this.audio.addEventListener("loadedmetadata",_.bind(this.setInitialCounter,this)),this.audio.addEventListener("timeupdate",_.bind(this.updateTime,this)),this.audio.addEventListener("ended",_.bind(this.ended,this)),this.playButton&&this.togglePlay&&this.playButton.addEventListener("click",_.bind(this.togglePlay,this)),this.progressBar&&(this.progressBar.addEventListener("mousedown",_.bind(this.seek,this)),this.progressBar.addEventListener("touchstart",_.bind(this.seek,this)),this.progressBar.addEventListener("mousemove",_.bind(this.scrub,this)),this.progressBar.addEventListener("mouseup",_.bind(this.seekEnd,this)),this.progressBar.addEventListener("touchend",_.bind(this.seekEnd,this)))))}var c,d,e=document.querySelectorAll(".js-podcast-player"),f=!1;b.prototype={constructor:b,duration:0,currentTime:0,togglePlay:function(){this.audio&&(this.audio.paused?(this.audio.play(),this.podcastContainer.classList.add("-playing"),c=new Event("playing"),this.podcastContainer.dispatchEvent(c)):(this.audio.pause(),this.podcastContainer.classList.remove("-playing"),c=new Event("paused"),this.podcastContainer.dispatchEvent(c)))},secondsToHMS:function(a){var b,c,d,e;return a?(b=Number(a),c=Math.floor(b/3600),d=Math.floor(b%3600/60),e=Math.floor(b%3600%60),(c>0?c+":"+(d<10?"0":""):"")+d+":"+(e<10?"0":"")+e):""},updateProgressBar:function(a){var b;this.progress&&this.audio&&a&&(b=a/this.duration*100,b<1&&(b=1),this.progress.style.width=b+"%")},setCounter:function(a){var b;this.counter&&this.audio&&a&&(b=document.createTextNode(this.secondsToHMS(a)),this.counter.innerHTML="",this.counter.appendChild(b))},updateCounter:function(){this.setCounter(this.duration-this.audio.currentTime)},updateTime:function(){this.audio&&!this.isScrubbing&&(!f&&300<this.audio.currentTime&&(c=new Event("5min"),this.podcastContainer.dispatchEvent(c),f=!0),this.updateProgressBar(this.audio.currentTime),this.updateCounter())},ended:function(){this.audio&&(c=new Event("ended"),this.podcastContainer.dispatchEvent(c))},setInitialCounter:function(){this.duration=this.audio.duration,this.setCounter(this.duration),this.counter.classList.add("-loaded")},setAudioTime:function(a){a&&this.audio&&(this.audio.currentTime=a)},seek:function(a){this.isScrubbing=!0},scrub:function(a){var b,c;this.isScrubbing&&this.audio&&this.progressBar&&(d=this.progressBar.getBoundingClientRect(),b=(a.pageX-d.left)/this.progressBar.offsetWidth,c=b*this.duration,this.updateProgressBar(c),this.setCounter(this.duration-c))},seekEnd:function(a){var b,c;this.audio&&this.progressBar&&(d=this.progressBar.getBoundingClientRect(),b=(a.pageX-d.left)/this.progressBar.offsetWidth,c=b*this.duration,this.updateProgressBar(c),this.setAudioTime(c),this.isScrubbing=!1)}},_.each(e,function(a){new b(a)})}(window),function(a,b){var c=b("ol.footnotes");c.length&&c.find("> li").each(function(a){var c=b(this),d=c.attr("id"),e=b('.espn-footnote-link[href="#'+d+'"]'),f=c.clone().wrapInner('<span class="espn-footnote-item-inner"></span>').wrapInner('<span class="espn-footnote-item"></span>').children(0).unwrap();e.after(f)}),b(a.document).on("click",".espn-footnote-link",function(c){var d,e=b(this),f=parseInt(e.data("footnote-id"),10),g=parseInt(e.find("sup").text(),10);c.preventDefault(),e.toggleClass("espn-footnote-item-expanded"),g===f?(e.find("sup").text("x"),d=e.next(".espn-footnote-item"),d.length&&(d.addClass("espn-footnote-item-displayed"),a.setTimeout(function(){d.addClass("espn-footnote-item-expanded")},50)),espn&&espn.track&&espn.track.trackLink({link:"#"+f,linkPos:a.s_omni.prop4,linkId:"footnote:open",site:"fivethirtyeight",pageName:a.s_omni.pageName,section:a.s_omni.channel})):(e.find("sup").text(f),e.next(".espn-footnote-item").removeClass("espn-footnote-item-expanded"),a.setTimeout(function(){e.next(".espn-footnote-item").removeClass("espn-footnote-item-displayed")},300),espn&&espn.track&&espn.track.trackLink({link:"#"+f,linkPos:a.s_omni.prop4,linkId:"footnote:close",site:"fivethirtyeight",pageName:a.s_omni.pageName,section:a.s_omni.channel}))}),b(a.document).on("click",".espn-footnote-item.espn-footnote-item-expanded",function(c){var d=b(this),e=d.prev("a.espn-footnote-link"),f=parseInt(e.data("footnote-id"),10);parseInt(e.find("sup").text(),10);c.preventDefault(),a.getSelection&&""!==a.getSelection().toString()||document.selection&&""!==document.selection.createRange().text||(d.removeClass("espn-footnote-item-expanded"),a.setTimeout(function(){d.removeClass("espn-footnote-item-displayed")},300),e.removeClass("espn-footnote-item-expanded").find("sup").text(f),espn&&espn.track&&espn.track.trackLink({link:"#"+f,linkPos:a.s_omni.prop4,linkId:"footnote:close",site:"fivethirtyeight",pageName:a.s_omni.pageName,section:a.s_omni.channel}))}),b(a.document).on("click",".espn-footnote-item.espn-footnote-item-expanded a, .espn-footnote-item.espn-footnote-item-expanded button",function(a){a.stopPropagation()})}(window,jQuery),window.espn.activateMobileHomepageTest=function(){var a,b=document.querySelector("body");a=new MutationObserver(function(a){jQuery("body").hasClass("reorder-home-page-done")||jQuery("body").hasClass("reorder-home-page")&&(jQuery(".widget-more-stories").appendTo(".col-a.home-col"),jQuery(".more-features").each(function(a,b){var c=jQuery(b);c.find(".post-info").prependTo(c.find(".hentry"))}),jQuery("body").addClass("reorder-home-page-done"))}),a.observe(b,{attributes:!0})},window.espn.activateMobileHomepageTest();;
(function() {
	var ajaxurl = window.ajaxurl || '/wp-admin/admin-ajax.php',
		data = window.wpcomVipAnalytics,
		dataQs, percent;

	if ( typeof XMLHttpRequest === 'undefined' ) {
		return;
	}

	if ( ! data ) {
		return;
	}

	percent = ~~data.percentToTrack;
	if ( percent && percent < 100 && ( ~~( ( Math.random() * 100 ) + 1 ) > percent ) ) {
		return;
	}

	dataQs = 'action=wpcom_vip_analytics';

	for ( var key in data ) {
		if ( key === 'percentToTrack' ) {
			continue;
		}
		if ( data.hasOwnProperty( key ) ) {
			dataQs += '&' +
				encodeURIComponent( key ).replace(/%20/g, '+' ) + '=' +
				encodeURIComponent( data[key] ).replace(/%20/g, '+' );
		}
	}

	function sendInfo() {
		var xhr = new XMLHttpRequest();
		xhr.open( 'POST', ajaxurl, true );
		xhr.setRequestHeader( 'Content-type', 'application/x-www-form-urlencoded' );
		xhr.send( dataQs );
	}

	// Delay for some time after the document is ready to ping
	function docReady() {
		setTimeout( function() {
			sendInfo();
		}, 1500 );
	}

	if ( document.readyState === 'complete' ) {
		docReady.apply();
	}
	else if ( document.addEventListener ) {
		document.addEventListener( 'DOMContentLoaded', docReady, false );
	}
	else if ( document.attachEvent ) {
		document.attachEvent( 'onreadystatechange', docReady );
	}
})();
;
